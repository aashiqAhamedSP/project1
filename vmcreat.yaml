---
- hosts: localhost
  tasks:
  - name: Create public IP address
    azure_rm_publicipaddress:
      resource_group: jenkin-rg
      allocation_method: Static
      name: docvmpbip
    register: output_ip_address
  - name: Public IP of VM
    debug:
      msg: "The public IP is {{ output_ip_address.state.ip_address }}."
  - name: Create virtual network interface card
    azure_rm_networkinterface:
      resource_group: jenkin-rg
      name: nicansi
      virtual_network: jenkins-vnet
      subnet: subnet1
      public_ip_name: docvmpbip
      security_group: nsg
  - name: Create a VM with resource group and vnet
    azure_rm_virtualmachine:
      resource_group: jenkin-rg
      name: docvm
      vm_size: Standard_DS1_v2
      managed_disk_type: Premium_LRS
      admin_username: vmadmin
      ssh_password_enabled: false
      ssh_public_keys:
      - path: /home/vmadmin/.ssh/authorized_keys
        key_data: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCuG3MLTEHMuLFu0w9v1H3KbGIrMtEQ0AFgKbHvL6+pw0a+zHDucLPoFiqe6TTa1eMwO2ibsOUjsdudiRSFSLlGBkiisQmwvf1IkmNlikEbzUG3Kivlvya5U+OZSWGFv7pwqbhN9G+pcgjBRquRTuSfsa5jp7yXL1FDTPNrt9mjSnIR/d5/nT0qvesZ2/2fdmsbXjEp2+a+0z3KgB+pj5L7fkymxkB/iNLjUk30ytT7TmNgsGAO2YhFyJW3r/ZWx+Nf93LOGbHb3j1CVU91oAlqSuXdGGHH9oB6ZVYJus8B4bfykIXrTF3b0YBPWMXqZgMSO7bi3dQ0xNVPIYeCHYD9kSHA9CRT2IDMR+CNufjXTmf9gm3aj0xp603W3n9QtmDwmt4CODNnnaAdxgwdzWvSqWDWB7JIQ8Usw3Utx44WluAdTbqC5VUo6mCL3pupAOBZuhGXT60Ich3ZimwBo3W3YEhPYbMpoh2EtLUpFslh5pwQJrBP60rr/30xb/pFqsSfpYEM4rLolE0hDpGxoeUUjBrOR0pDnmUBom1fJGrKoIaidVJ93Q/PLlcGDAGNeY4sGnv4/RBwE0DzNhEHLZhBNFWmc9CQllNKdhAc0uQNNoj5Xym69xhkM3pDEb/8cujQNtNIBV4IH0ulylRoLNjt96TgiKifOhxq8lSyQYpLnw== vmadmin@vm-build"
      network_interfaces: nicansi
      os_type: Linux
      image:
        offer: UbuntuServer
        publisher: Canonical
        sku: 18.04-LTS
        version: latest
